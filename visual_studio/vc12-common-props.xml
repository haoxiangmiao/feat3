<Project DefaultTargets="Build" ToolsVersion="12.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!-- include build-mode support -->
  <Import Project="vc12-build-modes.xml"/>

  <!-- Set platform toolset; must be defined before the following imports -->
  <PropertyGroup Label="Configuration">
    <!--<PlatformToolset>v120</PlatformToolset> -->
    <PlatformToolset>CTP_Nov2013</PlatformToolset>
  </PropertyGroup>

  <!-- ********************************************************************* -->
  <!-- Visual Studio Import Mumbo-Jumbo -->
  <!-- ********************************************************************* -->
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
    <Import Project="$(VCTargetsPath)\BuildCustomizations\CUDA 5.5.props"
      Condition="'$(CUDA_PATH)'!='' And '$(BackendCUDA)'=='true'"/>
  </ImportGroup>

  <!-- ********************************************************************* -->
  <!-- FEAST Paths and Names -->
  <!-- ********************************************************************* -->

  <!-- define FEAST debug prefix -->
  <PropertyGroup Condition="'$(DebugMode)'=='true'">
    <FeastDebugPrefix>dbg</FeastDebugPrefix>
  </PropertyGroup>
  <PropertyGroup Condition="'$(DebugMode)'!='true'">
    <FeastDebugPrefix>opt</FeastDebugPrefix>
  </PropertyGroup>

  <!-- define FEAST platform postfix -->
  <PropertyGroup Condition="'$(Platform)'=='Win32'">
    <FeastPlatform>x86</FeastPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Platform)'=='x64'">
    <FeastPlatform>x64</FeastPlatform>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Platform)'=='ARM'">
    <FeastPlatform>arm</FeastPlatform>
  </PropertyGroup>

  <!-- set default obj-path if necessary -->
  <PropertyGroup Condition="'$(FeastObjPath)'==''">
    <FeastObjPath>$(FeastRootPath)\obj</FeastObjPath>
  </PropertyGroup>

  <!-- set default lib-path if necessary -->
  <PropertyGroup Condition="'$(FeastLibPath)'==''">
    <FeastLibPath>$(FeastRootPath)\lib</FeastLibPath>
  </PropertyGroup>

  <!-- set default bin-path if necessary -->
  <PropertyGroup Condition="'$(FeastBinPath)'==''">
    <FeastBinPath>$(FeastRootPath)\win</FeastBinPath>
  </PropertyGroup>

  <!-- set default build name -->
  <PropertyGroup Condition="'$(FeastBuildName)'==''">
    <FeastBuildName>$(FeastAppName).vc12-$(Configuration)-$(FeastPlatform)</FeastBuildName>
  </PropertyGroup>

  <!-- ********************************************************************* -->
  <!-- FEAST Third-Party Library Detection -->
  <!-- ********************************************************************* -->
  <PropertyGroup Condition="Exists('..\lib\umfpack.vc12-$(FeastDebugPrefix)-$(FeastPlatform).lib')">
  <!--<PropertyGroup Condition="Exists('$(FeastLibPath)\umfpack.vc12-$(FeastDebugPrefix)-$(FeastPlatform).lib')">-->
    <FeastHaveUmfpack>true</FeastHaveUmfpack>
  </PropertyGroup>
  <PropertyGroup Condition="Exists('..\lib\alglib.vc12-$(FeastDebugPrefix)-$(FeastPlatform).lib')">
  <!--<PropertyGroup Condition="Exists('$(FeastLibPath)\alglib.vc12-$(FeastDebugPrefix)-$(FeastPlatform).lib')">-->
    <FeastHaveAlgLib>true</FeastHaveAlgLib>
  </PropertyGroup>

  <!-- ********************************************************************* -->
  <!-- FEAST Additional Paths and Dependencies -->
  <!-- ********************************************************************* -->

  <!-- FEAST pre-processor define list -->
  <ItemGroup Label="FEAST Defines">
    <FeastDef Condition="'$(DebugMode)'=='true'"
      Include="DEBUG" />
    <FeastDef Condition="'$(SerialMode)'=='true'"
      Include="SERIAL" />
    <FeastDef Condition="'$(SerialMode)'=='false'"
      Include="FEAST_MPI" />
    <FeastDef Condition="'$(BackendCUDA)'=='true'"
      Include="FEAST_BACKENDS_CUDA" />
    <FeastDef Condition="'$(BackendMKL)'=='true'"
      Include="FEAST_BACKENDS_MKL" />
    <FeastDef Condition="'$(FeastHaveUmfpack)'=='true'"
      Include="FEAST_HAVE_UMFPACK" />
    <FeastDef Condition="'$(FeastHaveAlgLib)'=='true'"
      Include="FEAST_HAVE_ALGLIB" />
  </ItemGroup>

  <!-- FEAST additional include directory list -->
  <ItemGroup Label="FEAST Include Paths">
    <FeastIncDir Condition="'$(SerialMode)'=='false'"
      Include="$(MSMPI_INC)" />
    <FeastIncDir Condition="'$(BackendMKL)'=='true'"
      Include="$(MKL_PATH)\include" />
    <FeastIncDir Condition="'$(FeastHaveUmfpack)'=='true'"
      Include="$(FeastRootPath)\thirdparty\AMD\Include;$(FeastRootPath)\thirdparty\SuiteSparse_config;$(FeastRootPath)\thirdparty\UMFPACK\Include" />
    <FeastIncDir Condition="'$(FeastHaveAlgLib)'=='true'"
      Include="$(FeastRootPath)\thirdparty\ALGLIB\src;" />
  </ItemGroup>

  <!-- FEAST additional library search path list -->
  <ItemGroup Label="FEAST Library Search Paths">
    <FeastLibDir Include="$(FeastLibPath)" />
    <FeastLibDir Condition="'$(SerialMode)'=='false' And '$(Platform)'=='Win32'"
      Include="$(MSMPI_LIB32)" />
    <FeastLibDir Condition="'$(SerialMode)'=='false' And '$(Platform)'=='x64'"
      Include="$(MSMPI_LIB64)" />
    <FeastLibDir Condition="'$(BackendCUDA)'=='true'"
      Include="$(CudaToolkitLibDir)" />
    <FeastLibDir Condition="'$(BackendMKL)'=='true' And '$(Platform)'=='Win32'"
      Include="$(MKL_PATH)\lib\ia32" />
    <FeastLibDir Condition="'$(BackendMKL)'=='true' And '$(Platform)'=='x64'"
      Include="$(MKL_PATH)\lib\intel64" />
  </ItemGroup>

  <!-- FEAST additional library dependencies list -->
  <ItemGroup Label="FEAST Library Dependencies">
    <FeastLibDep Condition="'$(SerialMode)'=='false'"
      Include="msmpi.lib" />
    <FeastLibDep Condition="'$(BackendCUDA)'=='true'"
      Include="cudart.lib;cublas.lib" />
    <FeastLibDep Condition="'$(BackendMKL)'=='true'"
      Include="mkl_core.lib;mkl_sequential.lib" />
    <FeastLibDep Condition="'$(BackendMKL)'=='true' And '$(Platform)'=='Win32'"
      Include="mkl_intel_c.lib" />
    <FeastLibDep Condition="'$(BackendMKL)'=='true' And '$(Platform)'=='x64'"
      Include="mkl_intel_lp64.lib" />
    <FeastLibDep Condition="'$(FeastHaveUmfpack)'=='true'"
      Include="umfpack.vc12-$(FeastDebugPrefix)-$(FeastPlatform).lib" />
    <FeastLibDep Condition="'$(FeastHaveAlgLib)'=='true'"
      Include="alglib.vc12-$(FeastDebugPrefix)-$(FeastPlatform).lib" />
  </ItemGroup>

  <!-- build properties from item lists -->
  <PropertyGroup>
    <FeastDefList>@(FeastDef)</FeastDefList>
    <FeastIncDirList>@(FeastIncDir)</FeastIncDirList>
    <FeastLibDirList>@(FeastLibDir)</FeastLibDirList>
    <FeastLibDepList>@(FeastLibDep)</FeastLibDepList>
  </PropertyGroup>

</Project>
