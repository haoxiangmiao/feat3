<?xml version="1.0" encoding="UTF-8"?>
<Worksheet>
<Version major="2015" minor="0"/>
<Label-Scheme value="2" prefix=""/>
<View-Properties presentation="false" autoexpanding_sections="true" UserProfileName="Maple Default Profile" NumericFormat-ApplyInteger="true" NumericFormat-ApplyRational="true" NumericFormat-ApplyExponent="false">
</View-Properties>
<MapleNet-Properties elisiondigitsbefore="100" labelling="true" indentamount="4" elisiontermsthreshold="10000" ansi="false" errorbreak="1" useclientjvm="true" echo="0" imaginaryunit="I" labelwidth="20" unitattributes="&quot;fontweight&quot; = &quot;bold&quot;" contextmenusize="automatic" plotdriver="opengl" elisiondigitsafter="100" plotoutput="terminal" helpbrowser="standard" rtablesize="10" elisiontermsbefore="100" elisiondigitsthreshold="10000" typesetting="extended" plotdevice="inline" verboseproc="1" showassumed="1" quiet="false" errorcursor="false" longdelim="true" plotoptions="" elisiontermsafter="100" screenwidth="79" preplot="" prettyprint="3" displayprecision="-1" screenpixelheight="1080" warnlevel="3" screenheight="25" latexwidth="8.0" postplot="" prompt="&gt; " ShowLabels="true"/>
<Styles>
<Font name="Ordered List 1" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Annotation Text" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Ordered List 2" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Ordered List 3" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Ordered List 4" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Ordered List 5" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Author" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Annotation Title" background="[255,255,255]" bold="true" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="18" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Warning" background="[0,0,0]" bold="false" executable="false" family="Monospaced" foreground="[0,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Caption Reference" background="[255,255,255]" bold="true" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Maple Input Placeholder" background="[255,255,255]" bold="true" executable="true" family="Courier New" foreground="[200,0,200]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="true"/>
<Font name="Maple Plot" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Code" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[255,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Line Printed Output" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[0,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Text Output" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[0,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Diagnostic" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[40,120,40]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="2D Inert Output" background="[255,255,255]" bold="false" executable="true" family="Times New Roman" foreground="[144,144,144]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Normal" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Hyperlink" background="[255,255,255]" bold="false" executable="false" family="Times New Roma" foreground="[0,128,128]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="true" placeholder="false"/>
<Font name="Maple Output" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Dash Item" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="2D Math" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Maple Input" background="[0,0,0]" bold="true" executable="true" family="Monospaced" foreground="[255,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="2D Output" background="[0,0,0]" bold="false" executable="false" family="Lucida Bright" foreground="[0,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="2D Input" background="[255,255,255]" bold="false" executable="true" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="HyperlinkError" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[255,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="true" placeholder="false"/>
<Font name="Header and Footer" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="10" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Error" background="[0,0,0]" bold="false" executable="false" family="Monospaced" foreground="[255,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Title" background="[255,255,255]" bold="true" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="18" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Heading 1" background="[255,255,255]" bold="true" executable="false" family="Times New Roma" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="18" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Text" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Bullet Item" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Heading 4" background="[255,255,255]" bold="false" executable="false" family="Times New Roma" foreground="[0,0,0]" italic="true" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Equation Label" background="[255,255,255]" bold="true" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Heading 3" background="[255,255,255]" bold="true" executable="false" family="Times New Roma" foreground="[0,0,0]" italic="true" opaque="false" readonly="false" size="14" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Heading 2" background="[255,255,255]" bold="true" executable="false" family="Times New Roma" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="16" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="HyperlinkWarning" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[0,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="true" placeholder="false"/>
<Font name="Dictionary Hyperlink" background="[255,255,255]" bold="false" executable="false" family="Times New Roma" foreground="[147,0,15]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="true" placeholder="false"/>
<Font name="Atomic Variable" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[175,0,175]" italic="true" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Caption Text" background="[255,255,255]" bold="true" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="List Item" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Layout name="Ordered List 1" alignment="left" bullet="numeric" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="-1" bulletsuffix=""/>
<Layout name="Ordered List 2" alignment="left" bullet="alphabetic" firstindent="0" leftmargin="36" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="-1" bulletsuffix=""/>
<Layout name="Ordered List 3" alignment="left" bullet="roman" firstindent="0" leftmargin="72" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="-1" bulletsuffix=""/>
<Layout name="Ordered List 4" alignment="left" bullet="ALPHABETIC" firstindent="0" leftmargin="108" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="-1" bulletsuffix=""/>
<Layout name="Ordered List 5" alignment="left" bullet="ROMAN" firstindent="0" leftmargin="144" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="-1" bulletsuffix=""/>
<Layout name="Author" alignment="centred" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="8" spacebelow="8" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Warning" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Annotation Title" alignment="centred" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="12" spacebelow="12" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Maple Plot" alignment="centred" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Line Printed Output" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="any" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Text Output" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="newline" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Diagnostic" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="any" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Normal" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Maple Output" alignment="centred" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.5" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Dash Item" alignment="left" bullet="dash" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="HyperlinkError" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Error" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Title" alignment="centred" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="12" spacebelow="12" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Heading 1" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="8" spacebelow="4" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Bullet Item" alignment="left" bullet="dot" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Heading 4" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Heading 3" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Heading 2" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="8" spacebelow="2" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="HyperlinkWarning" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="List Item" alignment="left" bullet="indent" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Pencil-style name="Pencil 5" pen-color="[255,0,0]" pen-height="5.0" pen-width="5.0" pen-opacity="1.0"/>
<Pencil-style name="Pencil 4" pen-color="[0,0,255]" pen-height="3.0" pen-width="3.0" pen-opacity="1.0"/>
<Pencil-style name="Pencil 3" pen-color="[0,0,0]" pen-height="3.0" pen-width="3.0" pen-opacity="1.0"/>
<Pencil-style name="Pencil 2" pen-color="[0,0,255]" pen-height="1.0" pen-width="1.0" pen-opacity="1.0"/>
<Pencil-style name="Pencil 1" pen-color="[0,0,0]" pen-height="1.0" pen-width="1.0" pen-opacity="1.0"/>
<Highlighter-style name="Highlighter 2" pen-color="[255,204,0]" pen-height="14.0" pen-width="14.0" pen-opacity="0.8"/>
<Highlighter-style name="Highlighter 1" pen-color="[255,153,255]" pen-height="12.0" pen-width="8.0" pen-opacity="0.8"/>
<Highlighter-style name="Highlighter 4" pen-color="[0,255,255]" pen-height="32.0" pen-width="32.0" pen-opacity="0.8"/>
<Highlighter-style name="Highlighter 3" pen-color="[51,255,0]" pen-height="24.0" pen-width="24.0" pen-opacity="0.8"/>
<Highlighter-style name="Highlighter 5" pen-color="[255,255,0]" pen-height="48.0" pen-width="48.0" pen-opacity="0.8"/>
</Styles>
<Startup-Code startupcode=""/>
<Task-table>
    <Task-category name="&lt;default&gt;"/>
</Task-table>
<Task/>
<Group labelreference="L63">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">with(CodeGeneration);with(Student[LinearAlgebra]);with(LinearAlgebra);</Text-field>
</Input>
</Group>
<Group labelreference="L4">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font style="Text" family="Liberation Serif" executable="true" size="14"># Space dimension
</Font>d := 3;
<Font foreground="[0,0,0]"># Number of basis functions for the local transformation</Font>
nphi := d+1;
<Font foreground="[0,0,0]"># x will hold the vertex coordinates of the physical element</Font>
xmat := Matrix(nphi,d,symbol=x);
<Font foreground="[0,0,0]"># xi is the vector of coordinates on the Rumpf reference element</Font>
xivec := Vector(d,symbol=xi);
<Font foreground="[0,0,0]"># Vertex coordinates of the Rumpf reference element</Font>
if (d=2) then
  xref := Matrix([[0, 0],[1, 0], [1/2, sqrt(3)/2]]);
elif (d=3) then
  xref := Matrix([[0, 0, 0],[1, 0, 0], [1/2, sqrt(3)/2, 0], [1/2, sqrt(3)/6, sqrt(6)/3]]);
end if;
<Font foreground="[0,0,0]"># Vertex coordinates of the Rumpf reference element on the optimal scale</Font>
xh := h*xref;</Text-field>
</Input>
</Group>
<Group labelreference="L5">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># Linear basis functions for the transformation from the reference element to the physical element</Font>
if (d = 2) then
  phi :=Vector(nphi,[1-xi[1]-xi[2], xi[1], xi[2] ]);
elif (d = 3) then
  phi :=Vector(nphi,[1-xi[1]-xi[2]-xi[3], xi[1], xi[2], xi[3] ]);
end if;
jac_phi := Matrix(nphi, d):
for i from 1 to nphi do
  for j from 1 to d do
    jac_phi(i,j) := diff(phi[i],xi[j]);
  end do;
end do;
grad_phi := Transpose(jac_phi);
grad_phi[1];</Text-field>
</Input>
</Group>
<Group labelreference="L6">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># R is the transformation from the Rumpf reference element to the physical element defined by x</Font>
for j from 1 to d do
  R[j](x,xi):= simplify(add(phi(i)*xmat[i,j],i=1..nphi));
end do;</Text-field>
</Input>
</Group>
<Group labelreference="L7">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># tmp will hold the gradient of the gradient of the transformation from the reference element to the physical element
</Font>tmp:=Matrix(d):
for j from 1 to d do
  for i from 1 to d do
     tmp(i,j):=(diff(R[i](x,xi),xi[j]));
  end do
end do;
<Font foreground="[0,0,0]"># e_inv is the gradient of the transformation from the Rumpf reference element to the reference element</Font>
e_inv:=simplify(Transpose(MatrixInverse(xref[2..d+1,1..d])));
<Font foreground="[0,0,0]"># grad_R is the gradient of the transformation from the Rumpf reference element to the physical element</Font>
grad_R := Transpose(simplify(tmp.e_inv/h));
inv_grad_R := MatrixInverse(grad_R);</Text-field>
</Input>
</Group>
<Group labelreference="L260">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">fval_frobenius := simplify((Trace(grad_R.Transpose(grad_R))-d)^2):</Text-field>
</Input>
</Group>
<Group labelreference="L36" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">cof_grad_R:=Matrix(d,d):
if(d=2) then
  cof_grad_R(1,1) := grad_R[2][2];
  cof_grad_R(1,2) := -grad_R[1][2];
  cof_grad_R(2,1) := -grad_R[2][1];
  cof_grad_R(2,2) := grad_R[1][1];
elif(d=3) then
  cof_grad_R(1,1) := grad_R[2][2]*grad_R[3][3] - grad_R[2][3]*grad_R[3][2]:
  cof_grad_R(2,1) := grad_R[2][3]*grad_R[3][1] - grad_R[2][1]*grad_R[3][3]:
  cof_grad_R(3,1) := grad_R[2][1]*grad_R[3][2] - grad_R[2][2]*grad_R[3][1]:
  cof_grad_R(1,2) := grad_R[1][3]*grad_R[3][2] - grad_R[1][2]*grad_R[3][3]:
  cof_grad_R(2,2) := grad_R[1][1]*grad_R[3][3] - grad_R[1][3]*grad_R[3][1]:
  cof_grad_R(3,2) := grad_R[1][2]*grad_R[3][1] - grad_R[1][1]*grad_R[3][2]:
  cof_grad_R(1,3) := grad_R[1][2]*grad_R[2][3] - grad_R[1][3]*grad_R[2][2]:
  cof_grad_R(2,3) := grad_R[1][3]*grad_R[2][1] - grad_R[1][1]*grad_R[2][3]:
  cof_grad_R(3,3) := grad_R[1][1]*grad_R[2][2] - grad_R[1][2]*grad_R[2][1]:
end if:
cof_grad_R:
fval_cof := simplify((Trace(cof_grad_R.Transpose(cof_grad_R))-d)^2);</Text-field>
</Input>
</Group>
<Group labelreference="L178">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">fval_det_1 := Determinant(grad_R);</Text-field>
</Input>
</Group>
<Group labelreference="L37" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">fval_det_2 := Determinant(grad_R)^2;</Text-field>
</Input>
</Group>
<Group labelreference="L180">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">fval_rec_det_1:=1/(fval_det_1 + sqrt(fac_reg^2 + fval_det_1^2));</Text-field>
</Input>
</Group>
<Group labelreference="L182" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">fval_rec_det_2:=fval_rec_det_1^2;</Text-field>
</Input>
</Group>
<Group labelreference="L70" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">frobenius_der_h := diff(fval_frobenius,h);
cof_der_h := diff(fval_cof,h);
det_1_der_h := diff(fval_det_1,h);
rec_det_1_der_h := diff(fval_rec_det_1,h):
det_2_der_h := diff(fval_det_2,h);
rec_det_2_der_h := diff(fval_rec_det_2,h):</Text-field>
</Input>
</Group>
<Group labelreference="L281" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_frobenius := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_frobenius[i,j] := fac_frobenius*diff(fval_frobenius,x[i,j]);
   end do
end do;
grad_frobenius:</Text-field>
</Input>
</Group>
<Group labelreference="L277" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">variational_grad_frobenius := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      variational_grad_frobenius[i,j] := fac_frobenius*4*(Trace(grad_R.Transpose(grad_R))-d)*(jac_phi[i].(e_inv).grad_R)[j]/h:
   end do
end do;
simplify(variational_grad_frobenius-grad_frobenius);</Text-field>
</Input>
</Group>
<Group labelreference="L285" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_cof := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_cof[i,j] := fac_cof*diff(fval_cof,x[i,j]);
   end do
end do;
grad_cof:</Text-field>
</Input>
</Group>
<Group labelreference="L295" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">frobenius_cof_grad_R_sqr := Trace(Transpose(cof_grad_R).cof_grad_R):
variational_grad_cof := Matrix(nphi,d):
for i from 1 to nphi do
  for j from 1 to d do
    #vec_jac_phi := Matrix(d,d);
    #vec_jac_phi[j] := Transpose(jac_phi[i].e_inv)/h;
    #vec_grad_phi := Transpose(vec_jac_phi);
    #M:=( inv_grad_R[j].(jac_phi[i].e_inv)/h*IdentityMatrix(d,d)
    #    - inv_grad_R.vec_grad_phi).(cof_grad_R);
    #variational_grad_cof[i,j] := 2*fac_cof*Trace(Transpose(cof_grad_R).M);
    variational_grad_cof[i,j] :=  4*fac_cof*(frobenius_cof_grad_R_sqr - d)*simplify(
                    inv_grad_R[j].(jac_phi[i].e_inv)/h*frobenius_cof_grad_R_sqr
                 - (cof_grad_R)[j].(Transpose(cof_grad_R).inv_grad_R.Transpose(jac_phi[i].e_inv))/h);
   end do;
end do;
simplify(grad_cof[3]-variational_grad_cof[3]);</Text-field>
</Input>
</Group>
<Group labelreference="L291" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">if(d=3) then
  writeto(&quot;variational_grad_cof.txt&quot;);
  C(variational_grad_cof, resultname=grad_cof1, declare=[fac_cof::numeric, x::numeric, h::numeric]);
  writeto(terminal);
end if;</Text-field>
</Input>
</Group>
<Group labelreference="L184" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_det_1 := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_det_1[i,j] := fac_det*diff(fval_det_1,x[i,j]);
   end do
end do;
grad_det_1;</Text-field>
</Input>
</Group>
<Group labelreference="L171" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_det_2 := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_det_2[i,j] := fac_det*diff(fval_det_2,x[i,j]);
   end do
end do;
grad_det_2:</Text-field>
</Input>
</Group>
<Group labelreference="L186" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_rec_det_1 := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_rec_det_1[i,j] := fac_rec_det*diff(fval_rec_det_1,x[i,j]);
   end do
end do;</Text-field>
</Input>
</Group>
<Group labelreference="L40" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_rec_det_2 := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_rec_det_2[i,j] := fac_rec_det*diff(fval_rec_det_2,x[i,j]);
   end do
end do;</Text-field>
</Input>
</Group>
<Group labelreference="L249" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># Write the generated C code to file
# Use declare to avoid Maple explicitly casting stuff
# DEFINITELY use evalf if you see Maple casting something to int in the generated C code!</Font>
interface(echo=0);
filename:=sprintf(&quot;%dd_p1.txt&quot;,d);
writeto(filename);</Text-field>
</Input>
</Group>
<Group labelreference="L264">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_frobenius,resultname=fval_frobenius_part, declare=[h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L242" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_cof,resultname=fval_cof_part, declare=[h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L255" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_det_1,resultname=fval_det_1_part, declare=[fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L253" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_rec_det_1,resultname=fval_rec_det_1_part, declare=[fac_reg::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L248" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_det_2,resultname=fval_det_2_part, declare=[fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L245" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_rec_det_2,resultname=fval_rec_det_2_part, declare=[fac_reg::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L266" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_frobenius,resultname=grad_frobenius_part, declare=[fac_det::numeric, fac_rec_det::numeric, fac_frobenius::numeric, fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L252" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_cof,resultname=grad_cof_part, declare=[fac_cof::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L244" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_det_1,resultname=grad_det_1_part, declare=[fac_det::numeric, fac_rec_det::numeric, fac_frobenius::numeric, fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L254" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_rec_det_1,resultname=grad_rec_det_1_part, declare=[fac_det::numeric, fac_rec_det::numeric, fac_frobenius::numeric, fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L251" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_det_2,resultname=grad_det_2_part, declare=[fac_det::numeric, fac_rec_det::numeric, fac_frobenius::numeric, fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L250" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_rec_det_2,resultname=grad_rec_det_2_part, declare=[fac_det::numeric, fac_rec_det::numeric, fac_frobenius::numeric, fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L268" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(frobenius_der_h,resultname=frobenius_der_h_part, declare=[fac_reg::numeric, x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L256" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(cof_der_h,resultname=cof_der_h_part, declare=[fac_reg::numeric, x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L246" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(det_1_der_h,resultname=det_1_der_h_part, declare=[fac_reg::numeric, x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L240" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(rec_det_1_der_h,resultname=rec_det_1_der_h_part, declare=[fac_reg::numeric, x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L241" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(det_2_der_h,resultname=det_2_der_h_part, declare=[fac_reg::numeric, x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L243" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(rec_det_2_der_h,resultname=rec_det_2_der_h_part, declare=[fac_reg::numeric, x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L247" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># Restore output to terminal</Font>
writeto(terminal);</Text-field>
</Input>
</Group>
<Group labelreference="L258" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># In order for the functional to have a minimum if the transformation is the identity, it's gradient wrt. fval_frobenius and fval_det has to be zero.
# The fval_frobenius part is, anyway, but for the det part, both terms have to be linked through a constant c depending on fac_reg
# This is the function of the determinant</Font>
f1(t):= t + c1/(t + sqrt(fac_reg^2 + t^2));</Text-field>
</Input>
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">df1 := eval(simplify(diff(f1(t),t)), t = 1);
cs1:=solve(df1=0,c1);
eval(cs1, fac_reg=0);</Text-field>
</Input>
</Group>
<Group labelreference="L164" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">f2(t):= t^2 + c1/(t + sqrt(fac_reg^2 + t^2))^2;
df2 := eval(simplify(diff(f2(t),t)), t = 1);
cs2:=solve(df2=0,c1);
eval(cs2, fac_reg=0);</Text-field>
</Input>
</Group>
<Group labelreference="L59" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># Check scaling of the various terms
# These should evaluate to zero</Font>
#eval(eval(fval_frobenius,x=xref),h[1]=1);
#simplify(eval(fval_frobenius,x=xh));</Text-field>
</Input>
</Group>
<Group labelreference="L57" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># How does the term scale if we transform from the Rumpf reference element with edge length 1 to the one with edge length h_1?
eval(eval(fval_det_1,x=xref),h=1);</Font>
simplify(eval(fval_det_1,x=xh));</Text-field>
</Input>
</Group>
<Group labelreference="L43" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># How does the term scale if we transform from the Rumpf reference element with edge length 1 to the one with edge length h_1?</Font>
#simplify(eval(eval(fval_rec_det_1,x=xref),h=1));
simplify(eval(fval_rec_det_1,x=xh));</Text-field>
</Input>
</Group>
<Group labelreference="L61" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># This is for the Q1Hack functional: All permutations (2 in 2d) for splitting the vanilla Q1 reference element into simplices (2 in 2d)
# For this, h has to be chosen differently for the frobenius term and the det, 1/det terms</Font>
xp[0] := Matrix( [ [-1, -1], [1,-1], [-1,1] ] );
xp[1] := Transpose(Matrix( [ [ 1, 1,-1], [-1, 1, 1] ] ));
xp[2] := Transpose(Matrix( [ [-1, 1,-1], [-1, 1, 1] ] ));
xp[3] := Transpose(Matrix( [ [-1, 1, 1], [-1,-1, 1] ] ));</Text-field>
</Input>
</Group>
<Group labelreference="L166" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># For the H_Evaluator: Determinant of the transformation of the Rumpf reference cell to this cell
</Font>h_eval_det:=eval(Determinant(grad_R), h=1);
C(h_eval_det, declare=[x::numeric], resultname=h_eval_det_);</Text-field>
</Input>
</Group>
<Group labelreference="L167" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># For the H_Evaluator: Gradient of the above determinant</Font>
grad_h_eval_det := Matrix(nphi,d);
for i from 1 to nphi do
   for j from 1 to d do
      grad_h_eval_det[i,j] := diff(h_eval_det,x[i,j]);
   end do
end do;
C(eval(grad_h_eval_det, [fac_frobenius = 0, fac_det=1, fac_rec_det=0, h=1]), resultname=grad_h_eval_det_);</Text-field>
</Input>
</Group>
<Group labelreference="L296" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"></Text-field>
</Input>
</Group>
</Worksheet>