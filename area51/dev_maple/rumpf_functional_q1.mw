<?xml version="1.0" encoding="UTF-8"?>
<Worksheet>
<Version major="2015" minor="0"/>
<Label-Scheme value="2" prefix=""/>
<View-Properties presentation="false" autoexpanding_sections="true" UserProfileName="Maple Default Profile" NumericFormat-ApplyInteger="true" NumericFormat-ApplyRational="true" NumericFormat-ApplyExponent="false">
</View-Properties>
<MapleNet-Properties elisiondigitsbefore="100" labelling="true" indentamount="4" elisiontermsthreshold="10000" ansi="false" errorbreak="1" useclientjvm="true" echo="1" imaginaryunit="I" labelwidth="20" unitattributes="&quot;fontweight&quot; = &quot;bold&quot;" contextmenusize="automatic" plotdriver="opengl" elisiondigitsafter="100" plotoutput="terminal" helpbrowser="standard" rtablesize="10" elisiontermsbefore="100" elisiondigitsthreshold="10000" typesetting="extended" plotdevice="inline" verboseproc="1" showassumed="1" quiet="false" errorcursor="false" longdelim="true" plotoptions="" elisiontermsafter="100" screenwidth="79" preplot="" prettyprint="3" displayprecision="-1" screenpixelheight="1080" warnlevel="3" screenheight="25" latexwidth="8.0" postplot="" prompt="&gt; " ShowLabels="true"/>
<Styles>
<Font name="Ordered List 1" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Annotation Text" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Ordered List 2" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Ordered List 3" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Ordered List 4" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Ordered List 5" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Author" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Annotation Title" background="[255,255,255]" bold="true" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="18" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Warning" background="[0,0,0]" bold="false" executable="false" family="Monospaced" foreground="[0,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Caption Reference" background="[255,255,255]" bold="true" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Maple Input Placeholder" background="[255,255,255]" bold="true" executable="true" family="Courier New" foreground="[200,0,200]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="true"/>
<Font name="Maple Plot" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Code" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[255,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Line Printed Output" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[0,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Text Output" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[0,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Diagnostic" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[40,120,40]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="2D Inert Output" background="[255,255,255]" bold="false" executable="true" family="Times New Roman" foreground="[144,144,144]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Normal" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Hyperlink" background="[255,255,255]" bold="false" executable="false" family="Times New Roma" foreground="[0,128,128]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="true" placeholder="false"/>
<Font name="Maple Output" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Dash Item" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="2D Math" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Maple Input" background="[0,0,0]" bold="true" executable="true" family="Monospaced" foreground="[255,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="2D Output" background="[0,0,0]" bold="false" executable="false" family="Lucida Bright" foreground="[0,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="2D Input" background="[255,255,255]" bold="false" executable="true" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="HyperlinkError" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[255,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="true" placeholder="false"/>
<Font name="Header and Footer" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="10" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Error" background="[0,0,0]" bold="false" executable="false" family="Monospaced" foreground="[255,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Title" background="[255,255,255]" bold="true" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="18" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Heading 1" background="[255,255,255]" bold="true" executable="false" family="Times New Roma" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="18" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Text" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Bullet Item" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Heading 4" background="[255,255,255]" bold="false" executable="false" family="Times New Roma" foreground="[0,0,0]" italic="true" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Equation Label" background="[255,255,255]" bold="true" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Heading 3" background="[255,255,255]" bold="true" executable="false" family="Times New Roma" foreground="[0,0,0]" italic="true" opaque="false" readonly="false" size="14" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Heading 2" background="[255,255,255]" bold="true" executable="false" family="Times New Roma" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="16" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="HyperlinkWarning" background="[255,255,255]" bold="false" executable="false" family="Courier New" foreground="[0,0,255]" italic="false" opaque="false" readonly="true" size="12" subscript="false" superscript="false" underline="true" placeholder="false"/>
<Font name="Dictionary Hyperlink" background="[255,255,255]" bold="false" executable="false" family="Times New Roma" foreground="[147,0,15]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="true" placeholder="false"/>
<Font name="Atomic Variable" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[175,0,175]" italic="true" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="Caption Text" background="[255,255,255]" bold="true" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Font name="List Item" background="[255,255,255]" bold="false" executable="false" family="Times New Roman" foreground="[0,0,0]" italic="false" opaque="false" readonly="false" size="12" subscript="false" superscript="false" underline="false" placeholder="false"/>
<Layout name="Ordered List 1" alignment="left" bullet="numeric" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="-1" bulletsuffix=""/>
<Layout name="Ordered List 2" alignment="left" bullet="alphabetic" firstindent="0" leftmargin="36" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="-1" bulletsuffix=""/>
<Layout name="Ordered List 3" alignment="left" bullet="roman" firstindent="0" leftmargin="72" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="-1" bulletsuffix=""/>
<Layout name="Ordered List 4" alignment="left" bullet="ALPHABETIC" firstindent="0" leftmargin="108" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="-1" bulletsuffix=""/>
<Layout name="Ordered List 5" alignment="left" bullet="ROMAN" firstindent="0" leftmargin="144" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="-1" bulletsuffix=""/>
<Layout name="Author" alignment="centred" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="8" spacebelow="8" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Warning" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Annotation Title" alignment="centred" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="12" spacebelow="12" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Maple Plot" alignment="centred" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Line Printed Output" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="any" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Text Output" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="newline" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Diagnostic" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="any" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Normal" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Maple Output" alignment="centred" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.5" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Dash Item" alignment="left" bullet="dash" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="HyperlinkError" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Error" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Title" alignment="centred" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="12" spacebelow="12" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Heading 1" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="8" spacebelow="4" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Bullet Item" alignment="left" bullet="dot" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Heading 4" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Heading 3" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="Heading 2" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="8" spacebelow="2" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="HyperlinkWarning" alignment="left" bullet="none" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="0" spacebelow="0" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Layout name="List Item" alignment="left" bullet="indent" firstindent="0" leftmargin="0" rightmargin="0" linespacing="0.0" spaceabove="3" spacebelow="3" linebreak="space" pagebreak-before="false" initial="0" bulletsuffix=""/>
<Pencil-style name="Pencil 5" pen-color="[255,0,0]" pen-height="5.0" pen-width="5.0" pen-opacity="1.0"/>
<Pencil-style name="Pencil 4" pen-color="[0,0,255]" pen-height="3.0" pen-width="3.0" pen-opacity="1.0"/>
<Pencil-style name="Pencil 3" pen-color="[0,0,0]" pen-height="3.0" pen-width="3.0" pen-opacity="1.0"/>
<Pencil-style name="Pencil 2" pen-color="[0,0,255]" pen-height="1.0" pen-width="1.0" pen-opacity="1.0"/>
<Pencil-style name="Pencil 1" pen-color="[0,0,0]" pen-height="1.0" pen-width="1.0" pen-opacity="1.0"/>
<Highlighter-style name="Highlighter 2" pen-color="[255,204,0]" pen-height="14.0" pen-width="14.0" pen-opacity="0.8"/>
<Highlighter-style name="Highlighter 1" pen-color="[255,153,255]" pen-height="12.0" pen-width="8.0" pen-opacity="0.8"/>
<Highlighter-style name="Highlighter 4" pen-color="[0,255,255]" pen-height="32.0" pen-width="32.0" pen-opacity="0.8"/>
<Highlighter-style name="Highlighter 3" pen-color="[51,255,0]" pen-height="24.0" pen-width="24.0" pen-opacity="0.8"/>
<Highlighter-style name="Highlighter 5" pen-color="[255,255,0]" pen-height="48.0" pen-width="48.0" pen-opacity="0.8"/>
</Styles>
<Startup-Code startupcode=""/>
<Task-table>
    <Task-category name="&lt;default&gt;"/>
</Task-table>
<Annotation-table>
    <Annotation-category name="&lt;default&gt;"/>
</Annotation-table>
<Task/>
<Group labelreference="L3">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">with(LinearAlgebra);with(CodeGeneration);</Text-field>
</Input>
</Group>
<Group labelreference="L4">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font style="Code" executable="true"># Space dimension
</Font>d := 3;
<Font foreground="[0,0,0]"># Number of basis functions for the local transformation</Font>
nphi := 2^d; xmat := Matrix(nphi,d,symbol=x);
<Font foreground="[0,0,0]"># xi is the vector of coordinates on the Rumpf reference element</Font>
xivec := Vector(d,symbol=xi);
<Font foreground="[0,0,0]"># Vertex coordinates of the Rumpf reference element</Font>
if(d=2) then
  xref:=Matrix([[-1,-1],[1,-1],[-1,1],[1,1]]);
elif(d=3) then
  xref:=Matrix([ [-1,-1,-1], [1,-1,-1], [-1,1,-1], [1,1,-1], [-1,-1,1], [1,-1,1], [-1,1,1], [1,1,1] ]);
end if;
normalised_ref_cell_vol := 2^(d);
<Font foreground="[0,0,0]"># Vertex coordinates of the Rumpf reference element on the optimal scale</Font>
xh := h*xref;</Text-field>
</Input>
</Group>
<Group labelreference="L263">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># Bilinear basis functions for the transformation from the reference element to the physical element</Font>
if(d=2) then
  phi[1](xi) := 1/4*(1 - xi[1] + (-1 + xi[1])*xi[2]);
  phi[2](xi) := 1/4*(1 + xi[1] + (-1 - xi[1])*xi[2]);
  phi[3](xi) := 1/4*(1 - xi[1] + ( 1 - xi[1])*xi[2]);
  phi[4](xi) := 1/4*(1 + xi[1] + ( 1 + xi[1])*xi[2]);
elif (d=3) then
  phi[1](xi) := 1/8*(1 - xi[1])*(1 - xi[2])*(1 - xi[3]);
  phi[2](xi) := 1/8*(1 + xi[1])*(1 - xi[2])*(1 - xi[3]);
  phi[3](xi) := 1/8*(1 - xi[1])*(1 + xi[2])*(1 - xi[3]);
  phi[4](xi) := 1/8*(1 + xi[1])*(1 + xi[2])*(1 - xi[3]);
  phi[5](xi) := 1/8*(1 - xi[1])*(1 - xi[2])*(1 + xi[3]);
  phi[6](xi) := 1/8*(1 + xi[1])*(1 - xi[2])*(1 + xi[3]);
  phi[7](xi) := 1/8*(1 - xi[1])*(1 + xi[2])*(1 + xi[3]);
  phi[8](xi) := 1/8*(1 + xi[1])*(1 + xi[2])*(1 + xi[3]);
end if;</Text-field>
</Input>
</Group>
<Group labelreference="L5" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">jac_phi := Matrix(nphi, d):
for i from 1 to nphi do
  for j from 1 to d do
    jac_phi(i,j) := diff(phi[i](xi),xi[j]);
  end do;
end do;
grad_phi := Transpose(jac_phi);
grad_phi[1];</Text-field>
</Input>
</Group>
<Group labelreference="L183">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># R is the transformation from the Rumpf reference element to the physical element defined by x</Font></Text-field>
</Input>
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">for j from 1 to d do
  R[j](x,xi):= simplify(add(phi[i]( xi )*xmat[i,j],i=1..nphi));
end do;</Text-field>
</Input>
</Group>
<Group labelreference="L195" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">invC:=1/h*IdentityMatrix(d,d);</Text-field>
</Input>
</Group>
<Group labelreference="L265">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># gradR is the gradient of the transformation from the Rumpf reference element to the physical element</Font></Text-field>
</Input>
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">tmp := Matrix(d):
for l from 1 to d do
  tmp[l] := add(xmat[i,l]*Transpose(jac_phi[i]), i=1..nphi):
end do:
grad_R := (x,xi) -&gt; Matrix(tmp.invC):
grad_R(x,xi);
inv_grad_R := MatrixInverse(grad_R(x,xi));
det_grad_R:=Determinant(grad_R(x,xi));</Text-field>
</Input>
</Group>
<Group labelreference="L331" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">frobenius_grad_R_sqr := simplify(Trace(grad_R(x,xi).Transpose(grad_R(x,xi))));</Text-field>
</Input>
</Group>
<Group labelreference="L193" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">integrand_frobenius := ((frobenius_grad_R_sqr - d)^2)/normalised_ref_cell_vol;
fval_frobenius := integrand_frobenius:
for i from 1 to d do
  fval_frobenius := simplify(int(fval_frobenius,xi[i]=-1..1)):
end do:
&quot;fval_frobenius&quot;,(fval_frobenius);</Text-field>
</Input>
</Group>
<Group labelreference="L267" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">cof_grad_R:=Matrix(d,d):
if(d=2) then
  cof_grad_R(1,1) :=  grad_R(x,xi)[2][2];
  cof_grad_R(1,2) := -grad_R(x,xi)[1][2];
  cof_grad_R(2,1) := -grad_R(x,xi)[2][1];
  cof_grad_R(2,2) :=  grad_R(x,xi)[1][1];
elif(d=3) then
  cof_grad_R(1,1) := grad_R(x,xi)[2][2]*grad_R(x,xi)[3][3] - grad_R(x,xi)[2][3]*grad_R(x,xi)[3][2]:
  cof_grad_R(2,1) := grad_R(x,xi)[2][3]*grad_R(x,xi)[3][1] - grad_R(x,xi)[2][1]*grad_R(x,xi)[3][3]:
  cof_grad_R(3,1) := grad_R(x,xi)[2][1]*grad_R(x,xi)[3][2] - grad_R(x,xi)[2][2]*grad_R(x,xi)[3][1]:
  cof_grad_R(1,2) := grad_R(x,xi)[1][3]*grad_R(x,xi)[3][2] - grad_R(x,xi)[1][2]*grad_R(x,xi)[3][3]:
  cof_grad_R(2,2) := grad_R(x,xi)[1][1]*grad_R(x,xi)[3][3] - grad_R(x,xi)[1][3]*grad_R(x,xi)[3][1]:
  cof_grad_R(3,2) := grad_R(x,xi)[1][2]*grad_R(x,xi)[3][1] - grad_R(x,xi)[1][1]*grad_R(x,xi)[3][2]:
  cof_grad_R(1,3) := grad_R(x,xi)[1][2]*grad_R(x,xi)[2][3] - grad_R(x,xi)[1][3]*grad_R(x,xi)[2][2]:
  cof_grad_R(2,3) := grad_R(x,xi)[1][3]*grad_R(x,xi)[2][1] - grad_R(x,xi)[1][1]*grad_R(x,xi)[2][3]:
  cof_grad_R(3,3) := grad_R(x,xi)[1][1]*grad_R(x,xi)[2][2] - grad_R(x,xi)[1][2]*grad_R(x,xi)[2][1]:
end if:
cof_grad_R:
integrand_cof := simplify((Trace(cof_grad_R.Transpose(cof_grad_R))-d)^2)/normalised_ref_cell_vol;
fval_cof := integrand_cof;
for i from 1 to d do
  fval_cof := simplify(int(fval_cof,xi[i]=-1..1)):
end do:
&quot;fval_cof&quot;,(fval_cof);</Text-field>
</Input>
</Group>
<Group labelreference="L219" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">integrand_det_1 := simplify(det_grad_R)/normalised_ref_cell_vol;
<Font foreground="[0,0,0]"># Integrate det over the Rumpf reference cell
# Divide by the scaled Rumpf reference cell's volume so the result is independent of the absolute scaling.
# Otherwise the sum over all elements would vary with the refinement level</Font>
fval_det_1 := integrand_det_1:
for i from 1 to d do
  fval_det_1 := simplify(int(fval_det_1, xi[i] = -1..1)):
end do:
&quot;fval_det_1&quot;,fval_det_1;</Text-field>
</Input>
</Group>
<Group labelreference="L213" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">integrand_det_2 := simplify(det_grad_R^2)/normalised_ref_cell_vol;
<Font foreground="[0,0,0]"># Integrate det over the Rumpf reference cell
# Divide by the scaled Rumpf reference cell's volume so the result is independent of the absolute scaling.
# Otherwise the sum over all elements would vary with the refinement level</Font>
fval_det_2 := integrand_det_2:
for i from 1 to d do
  fval_det_2 := simplify(int(fval_det_2, xi[i] = -1..1)):
end do:
&quot;fval_det_2&quot;,fval_det_2;</Text-field>
</Input>
</Group>
<Group labelreference="L223" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">integrand_rec_det_1 := 1/(det_grad_R + sqrt(fac_reg^2 + det_grad_R^2))/normalised_ref_cell_vol;
fval_rec_det_1 := 0:
<Font foreground="[0,0,0]"># Integrate the 1/det term over the Rumpf reference cell by the trapezoidal rule</Font>
if (d=2) then
  for i from 1 to 2^d do
      fval_rec_det_1 := fval_rec_det_1 + eval(integrand_rec_det_1,xi=xref[i]):
  end do;
elif (d=3) then
  for i from 1 to d do
    for j from 1 to d do
      for k from 1 to d do
        fval_rec_det_1 := fval_rec_det_1 + eval(integrand_rec_det_1,xi=xref[i]):
      end do;
    end do;
  end do;
end if;
&quot;fval_rec_det_1&quot;,fval_rec_det_1;</Text-field>
</Input>
</Group>
<Group labelreference="L269" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">integrand_rec_det_2 := 1/(det_grad_R + sqrt(fac_reg^2 + det_grad_R^2))^2;
fval_rec_det_2 := 0:
<Font foreground="[0,0,0]"># Integrate the 1/det term over the Rumpf reference cell by the trapezoidal rule</Font>
if (d=2) then
  for i from 1 to 2^d do
      fval_rec_det_2 := fval_rec_det_2 + (2)^(-d)*eval(integrand_rec_det_2,xi=xref[i]):
  end do;
elif (d=3) then
  for i from 1 to d do
    for j from 1 to d do
      for k from 1 to d do
        fval_rec_det_2 := fval_rec_det_2 + 2^(-d)*eval(integrand_rec_det_2,xi=ref[i]):
      end do;
    end do;
  end do;
end if;
&quot;fval_rec_det_2&quot;,fval_rec_det_2;</Text-field>
</Input>
</Group>
<Group labelreference="L271" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">frobenius_der_h := diff(fval_frobenius,h);
cof_der_h := diff(fval_cof,h);
det_1_der_h := diff(fval_det_1,h);
rec_det_1_der_h := diff(fval_rec_det_1,h):
det_2_der_h := diff(fval_det_2,h);
rec_det_2_der_h := diff(fval_rec_det_2,h):</Text-field>
</Input>
</Group>
<Group labelreference="L300" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_frobenius := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_frobenius[i,j] := fac_frobenius*diff(fval_frobenius,x[i,j]);
   end do
end do;
&quot;grad_frobenius&quot;,grad_frobenius;</Text-field>
</Input>
</Group>
<Group labelreference="L297" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_cof := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_cof[i,j] := fac_cof*diff(fval_cof,x[i,j]);
   end do
end do;
&quot;grad_cof&quot;,grad_cof:</Text-field>
</Input>
</Group>
<Group labelreference="L307" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_det_1 := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_det_1[i,j] := fac_det*diff(fval_det_1,x[i,j]);
   end do
end do;
&quot;grad_det_1&quot;,grad_det_1;</Text-field>
</Input>
</Group>
<Group labelreference="L306" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_det_2 := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_det_2[i,j] := fac_det*diff(fval_det_2,x[i,j]);
   end do
end do;
grad_det_2:</Text-field>
</Input>
</Group>
<Group labelreference="L308" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_rec_det_1 := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_rec_det_1[i,j] := fac_rec_det*diff(fval_rec_det_1,x[i,j]);
   end do
end do;
&quot;grad_rec_det_1&quot;,grad_rec_det_1;</Text-field>
</Input>
</Group>
<Group labelreference="L305" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">grad_rec_det_2 := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_rec_det_2[i,j] := fac_rec_det*diff(fval_rec_det_2,x[i,j]);
   end do
end do;</Text-field>
</Input>
</Group>
<Group labelreference="L310" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># Write the generated C code to file
# Use declare to avoid Maple explicitly casting stuff
# DEFINITELY use evalf if you see Maple casting something to int in the generated C code!</Font>
interface(echo=0);
filename:=sprintf(&quot;%dd_q1.txt&quot;,d);
writeto(filename);</Text-field>
</Input>
</Group>
<Group labelreference="L315">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_frobenius,resultname=fval_frobenius_part, declare=[h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L328" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_cof,resultname=fval_cof_part, declare=[h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L316" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_det_1,resultname=fval_det_1_part, declare=[fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L311" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_rec_det_1,resultname=fval_rec_det_1_part, declare=[fac_reg::numeric, x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L313" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_det_2,resultname=fval_det_2_part, declare=[fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L324" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(fval_rec_det_2,resultname=fval_rec_det_2_part, declare=[fac_reg::numeric, x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L312" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_frobenius,resultname=grad_frobenius_part, declare=[fac_frobenius::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L321" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_cof,resultname=grad_cof_part, declare=[fac_cof::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L325" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_det_1,resultname=grad_det_1_part, declare=[fac_det::numeric, fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L314" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_rec_det_1,resultname=grad_rec_det_1_part, declare=[fac_rec_det::numeric, fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L320" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_det_2,resultname=grad_det_2_part, declare=[fac_rec_det::numeric, fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L319" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(grad_rec_det_2,resultname=grad_rec_det_2_part, declare=[fac_det::numeric, fac_rec_det::numeric, fac_frobenius::numeric, fac_reg::numeric, h::numeric, x::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L327" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(frobenius_der_h,resultname=frobenius_der_h_part, declare=[x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L318" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(cof_der_h,resultname=cof_der_h_part, declare=[fac_reg::numeric, x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L317" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(det_1_der_h,resultname=det_1_der_h_part, declare=[x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L323" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(rec_det_1_der_h,resultname=rec_det_1_der_h_part, declare=[fac_reg::numeric, x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L322" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(det_2_der_h,resultname=det_2_der_h_part, declare=[x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L326" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">C(rec_det_2_der_h,resultname=rec_det_2_der_h_part, declare=[fac_reg::numeric, x::numeric, h::numeric]);</Text-field>
</Input>
</Group>
<Group labelreference="L246" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># Restore output to terminal</Font>
writeto(terminal);</Text-field>
</Input>
</Group>
<Group labelreference="L261" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># In order for the functional to have a minimum if the transformation is the identity, it's gradient wrt. norm_A and det_A has to be zero.
# The norm_A part is, anyway, but for the det part, both terms have to be linked through a constant c depending on fac_reg
# This is the function of the determinant</Font>
f1(t):= t + c1/(t + sqrt(fac_reg^2 + t^2));</Text-field>
</Input>
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">df1 := eval(simplify(diff(f1(t),t)), t = 1);
cs1:=solve(df1=0,c1);
eval(cs1, fac_reg=0);</Text-field>
</Input>
</Group>
<Group labelreference="L260" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">f2(t):= t^2 + c1/(t + sqrt(fac_reg^2 + t^2))^2;
df2 := eval(simplify(diff(f2(t),t)), t = 1);
cs2:=solve(df2=0,c1);
eval(cs2, fac_reg=0);</Text-field>
</Input>
</Group>
<Group labelreference="L32" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># Check the norm term's scaling
# x = xh means that the transformation is the identity mapping from the Rumpf reference cell to itself</Font>
eval(fval_frobenius,x=xh);
<Font foreground="[0,0,0]"># h=1 and x = xref means that the transformation is the identity mapping from the vanilla reference cell to itself</Font>
eval(fval_frobenius,[x=xref,h=1]);
<Font foreground="[0,0,0]"># Both should evaluate to 0</Font></Text-field>
</Input>
</Group>
<Group labelreference="L33" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">eval(fval_det_1, x = xh);
eval(fval_det_1, [x = xref, h = 1]);</Text-field>
</Input>
</Group>
<Group labelreference="L34" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">simplify(eval(fval_rec_det_1, x = xh));
simplify(eval(fval_rec_det_1, [x = xref, h = 1]));</Text-field>
</Input>
</Group>
<Group labelreference="L81" drawlabel="true">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># Check if the derivative of the norm term is really zero, too
# First one the the mapping from the Rumpf reference cell to itself, the second is the mapping of the vanilla reference cell to itself
# All these should evaluate to zero</Font>
eval(diff( fval_frobenius,x[1,1] ),x=xh);
eval(diff( fval_frobenius,x[1,1] ),[h=1,x=xref]);</Text-field>
</Input>
</Group>
<Group labelreference="L173" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># For the H_Evaluator: Determinant of the transformation of the Rumpf reference cell to this cell</Font>
h_eval_det := det_grad_R/normalised_ref_cell_vol:
for i from 1 to d do
  h_eval_det:= int(eval(h_eval_det, [h=1]),xi[i]=-1..1):
end do:
C(h_eval_det, declare=[x::numeric], resultname=h_eval_det_);</Text-field>
</Input>
</Group>
<Group labelreference="L185" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal">eval(h_eval_det,x=xref);</Text-field>
</Input>
</Group>
<Group labelreference="L172" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"><Font foreground="[0,0,0]"># For the H_Evaluator: Gradient of the above determinant</Font>
grad_h_eval_det_1 := Matrix(nphi,d):
for i from 1 to nphi do
   for j from 1 to d do
      grad_h_eval_det_1[i,j] := diff(h_eval_det,x[i,j]);
   end do
end do;
C(eval(grad_h_eval_det, [fac_norm = 0, fac_det=1, fac_rec_det=0, h=1]), resultname=grad_h_eval_det);</Text-field>
</Input>
</Group>
<Group labelreference="L329" drawlabel="true" applyint="true" applyrational="true" applyexponent="false">
<Input>
<Text-field prompt="&gt; " style="Maple Input" layout="Normal"></Text-field>
</Input>
</Group>
</Worksheet>